{% extends "home_base.html" %}

{% block title %}
	User Manage
{% endblock %}

{% block subContent %}

    <div class="container mt-4">
        <form id="userSerchForm" onsubmit="handleSearch(event)">
            <div class="row justify-content-center">
                <div class="col-12 col-md-3 mb-3">
                    <label for="search1" class="form-label w-100 text-success d-flex align-items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                            <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
                        </svg>
                        User Name
                    </label>
                    <input type="text" id="search1" class="form-control border-success" name="user_name" placeholder="Enter User Name ...">
                </div>
                <div class="col-12 col-md-3 mb-3">
                    <label for="search2" class="form-label w-100 text-success d-flex align-items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-vcard" viewBox="0 0 16 16">
                            <path d="M5 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4m4-2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5M9 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4A.5.5 0 0 1 9 8m1 2.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5"/>
                            <path d="M2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zM1 4a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H8.96q.04-.245.04-.5C9 10.567 7.21 9 5 9c-2.086 0-3.8 1.398-3.984 3.181A1 1 0 0 1 1 12z"/>
                        </svg>
                        First Name
                    </label>
                    <input type="text" id="search2" class="form-control border-success" name="first_name" placeholder="Enter First Name ...">
                </div>
                <div class="col-12 col-md-3 mb-3">
                    <label for="search3" class="form-label w-100 text-success d-flex align-items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-vcard" viewBox="0 0 16 16">
                            <path d="M5 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4m4-2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5M9 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4A.5.5 0 0 1 9 8m1 2.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5"/>
                            <path d="M2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zM1 4a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H8.96q.04-.245.04-.5C9 10.567 7.21 9 5 9c-2.086 0-3.8 1.398-3.984 3.181A1 1 0 0 1 1 12z"/>
                        </svg>
                        Last Name
                    </label>
                    <input type="text" id="search3" class="form-control border-success" name="last_name" placeholder="Enter Last Name ...">
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-12 col-md-auto mb-3">
                    <button class="btn btn-success d-flex align-items-center gap-2" type="submit">
                        Search
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                        </svg>
                    </button>
                </div>
                <div class="col-12 col-md-auto mb-3">
                    <button class="btn btn-outline-success d-flex align-items-center gap-2" type="reset">
                        Clear&nbsp;&nbsp;&nbsp;
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eraser" viewBox="0 0 16 16">
                            <path d="M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828zm2.121.707a1 1 0 0 0-1.414 0L4.16 7.547l5.293 5.293 4.633-4.633a1 1 0 0 0 0-1.414zM8.746 13.547 3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </form>
        <div class="mb-3" style="height: 1px; background: linear-gradient(to right, #e0e0e0, #9e9e9e, #e0e0e0);"></div>
        <h4 class="text-success d-flex align-items-center gap-2 mb-3 text-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" class="bi bi-bar-chart-line" viewBox="0 0 16 16">
                <path d="M11 2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v12h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3h1V7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7h1zm1 12h2V2h-2zm-3 0V7H7v7zm-5 0v-3H2v3z"/>
            </svg>
            Search Result
        </h4>
        <div class="table-responsive mb-3">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col" style="display: none;">User Id</th>
                        <th class="text-success" scope="col">User Name</th>
                        <th class="text-success" scope="col">Email</th>
                        <th class="text-success" scope="col">First Name</th>
                        <th class="text-success" scope="col">Last Name</th>
                        <th class="text-success" scope="col">Location</th>
                        <th class="text-success" scope="col">Role</th>
                        <th class="text-success" scope="col">Status</th>
                    </tr>
                </thead>
                <tbody id="userTable">   
                </tbody>  
            </table>
        </div>
    </div>

    <script>

        function handleSearch(event) {
            event.preventDefault();
            refillTableData();
        }

        function refillTableData() {
            const formData = new FormData(document.querySelector('#userSerchForm'));
			const urlEncodedData = new URLSearchParams(formData).toString();
			getFetch(`/api/user/list?${urlEncodedData}`, {
			}).onSuccess((data) => {
                const tbody = document.getElementById('userTable');
                tbody.innerHTML = '';
                data['data'].forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="display: none;">${item['user_id']}</td>
                        <td>${item['user_name']}</td>
                        <td>${item['email']}</td>
                        <td>${item['first_name']}</td>
                        <td>${item['last_name']}</td>
                        <td>${item['location']}</td>
                        <td>
                            <button type="button" class="btn" id="tableRole${item['user_id']}"></button>
                        </td>
                        <td>
                            <button type="button" class="btn" id="tableStatus${item['user_id']}">${item['status']}</button>
                        </td>
                        `;
                    tbody.appendChild(row);
                    Role.getRole(item['role']).handleProfileBadge(row.querySelector(`#tableRole${item['user_id']}`));
                    const statusButton = row.querySelector(`#tableStatus${item['user_id']}`);
                    if (item['status'] === 'active') {
                        statusButton.classList.add('btn-outline-success');
                    } else if (item['status'] === 'inactive') {
                        statusButton.classList.add('btn-outline-danger');
                    }
                });
            })
        }
        
    </script>

{% endblock %}